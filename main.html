<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Calendar</title>
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --accent:#d32f2f;
      --muted:#444;
      --surface:#ffffff;
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:#ffffff;color:#000000}
    .wrap{max-width:980px;margin:36px auto;padding:24px;background:#ffffff;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0;color:var(--accent)}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{background:transparent;border:1px solid #ccc;padding:8px 10px;border-radius:10px;color:#333;cursor:pointer}
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    .month-display{font-weight:600;font-size:18px;color:var(--accent)}

    .calendar{display:grid;grid-template-rows:auto 1fr;gap:8px}
    .weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;padding:6px}
    .weekday{font-size:12px;color:#666;text-align:center;font-weight:600}

    .days{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .day{min-height:100px;padding:8px;border-radius:10px;background:#f9f9f9;cursor:pointer;outline:none;border:1px solid #eee;display:flex;flex-direction:column}
    .day.outside{opacity:0.45}
    .day.today{border:2px solid var(--accent);background:#ffeaea;position:relative}
    .day .date{font-weight:600;margin-bottom:4px}
    .day .events{display:flex;flex-direction:column;gap:4px;flex-wrap:wrap;overflow-wrap:break-word;font-size:12px;color:#d32f2f}

    .legend{margin-top:12px;display:flex;gap:10px;align-items:center;color:#666;font-size:13px}
    .small{font-size:13px;color:#666}

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-in-out;
    }
    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }
    .modal {
      background: #fff;
      border-radius: var(--radius);
      padding: 20px;
      max-width: 350px;
      width: 90%;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      animation: fadeIn 0.25s ease;
    }
    @keyframes fadeIn {
      from {transform: scale(0.95); opacity: 0;}
      to {transform: scale(1); opacity: 1;}
    }
    .modal h2 {
      color: var(--accent);
      font-size: 18px;
      margin-top: 0;
    }
    .modal input, .modal select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
    }
    .modal .time-row {
      display:flex; gap:6px; margin-top:10px; align-items:center;
    }
    .modal .actions {
      margin-top: 14px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    .modal button {
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .modal .save {
      background: var(--accent);
      color: white;
    }
    .modal .cancel {
      background: #eee;
    }

    @media (max-width:640px){
      .wrap{margin:18px;padding:16px}
      .day{min-height:80px}
    }
  </style>
</head>
<body>
  <main class="wrap" role="application" aria-label="Interactive calendar">
    <header>
      <h1>Calendar</h1>
      <div class="controls">
        <button class="btn" id="prev" aria-label="Previous month">◀</button>
        <div class="month-display" id="monthDisplay">Month Year</div>
        <button class="btn" id="next" aria-label="Next month">▶</button>
        <button class="btn" id="todayBtn">Today</button>
      </div>
    </header>

    <section class="calendar">
      <div class="weekdays" id="weekdays"></div>
      <div class="days" id="days" tabindex="0"></div>
    </section>

    <div class="legend">
      <span class="small">Click a day to add an event (stored locally).</span>
    </div>
  </main>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true">
      <h2 id="modalDate"></h2>
      <input type="text" id="eventInput" placeholder="Event name..." />

      <!-- Time Selector -->
      <div class="time-row">
        <select id="hour"></select>
        <span>:</span>
        <select id="minute"></select>
        <select id="ampm">
          <option>AM</option>
          <option>PM</option>
        </select>
      </div>

      <div class="actions">
  <button class="cancel" id="cancelBtn">Cancel</button>
  <button class="delete" id="deleteBtn" style="display:none; background:#999; color:#fff;">Delete</button>
  <button class="save" id="saveBtn">Save</button>
</div>

    </div>
  </div>

  <script>
    const state = {
      viewDate: new Date(),
      events: JSON.parse(localStorage.getItem('calendarEvents') || '{}'),
      selectedDate: null
    }
function timeToMinutes(timeStr) {
  if (!timeStr) return 24*60; // put events with no time at the end
  const parts = timeStr.split(' ')
  if (parts.length !== 2) return 24*60
  const [hm, ampm] = parts
  let [h, m] = hm.split(':').map(n => parseInt(n, 10))
  if (isNaN(h) || isNaN(m)) return 24*60
  if (ampm.toUpperCase() === 'PM' && h !== 12) h += 12
  if (ampm.toUpperCase() === 'AM' && h === 12) h = 0
  return h*60 + m
}

    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']
    const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December']

    const monthDisplay = document.getElementById('monthDisplay')
    const daysEl = document.getElementById('days')
    const weekdaysEl = document.getElementById('weekdays')

    // Buttons
    document.getElementById('prev').addEventListener('click', ()=>changeMonth(-1))
    document.getElementById('next').addEventListener('click', ()=>changeMonth(1))
    document.getElementById('todayBtn').addEventListener('click', ()=>{state.viewDate=new Date(); render()})

    const modalOverlay = document.getElementById('modalOverlay')
    const modalDate = document.getElementById('modalDate')
    const eventInput = document.getElementById('eventInput')
    const cancelBtn = document.getElementById('cancelBtn')
    //Buttons
    const saveBtn = document.getElementById('saveBtn')
    const deleteBtn = document.getElementById('deleteBtn')
    let editingIndex = null
    //Time
    const hourSelect = document.getElementById('hour')
    const minuteSelect = document.getElementById('minute')
    const ampmSelect = document.getElementById('ampm')

    cancelBtn.addEventListener('click', closeModal)
    modalOverlay.addEventListener('click', (e)=>{ if(e.target===modalOverlay) closeModal() })
    saveBtn.addEventListener('click', saveEvent)
    deleteBtn.addEventListener('click', deleteEvent)


    // Populate hour/minute dropdowns
    for(let i=1;i<=12;i++){ 
      const opt = document.createElement('option'); 
      opt.value = i; 
      opt.textContent = i; 
      hourSelect.appendChild(opt)
    }
    for(let i=0;i<60;i+=5){ 
      const opt = document.createElement('option'); 
      opt.value = i.toString().padStart(2,'0'); 
      opt.textContent = i.toString().padStart(2,'0'); 
      minuteSelect.appendChild(opt)
    }

    function saveEvents(){
      localStorage.setItem('calendarEvents', JSON.stringify(state.events))
    }

    function saveEvent() {
  const name = eventInput.value.trim()
  if (!name) return

  const hour = hourSelect.value
  const minute = minuteSelect.value
  const ampm = ampmSelect.value
  const time = `${hour}:${minute} ${ampm}`

  const key = getKey(state.selectedDate)
  const existing = state.events[key] || []

  if (editingIndex !== null) {
    // Update existing event
    existing[editingIndex] = { name, time }
  } else {
    // Add new event
    existing.push({ name, time })
  }

  state.events[key] = existing
  saveEvents()
  closeModal()
  render()
}

function deleteEvent() {
  const key = getKey(state.selectedDate)
  if (editingIndex !== null && state.events[key]) {
    state.events[key].splice(editingIndex, 1)
    if (state.events[key].length === 0) delete state.events[key]
    saveEvents()
    closeModal()
    render()
  }
}


    function getKey(date){
      return date.toISOString().slice(0,10)
    }

    function renderWeekdays(){
      weekdaysEl.innerHTML = ''
      weekdays.forEach(d=>{
        const el = document.createElement('div')
        el.className='weekday'
        el.textContent=d
        weekdaysEl.appendChild(el)
      })
    }

function render() {
  renderWeekdays()
  daysEl.innerHTML = ''
  const year = state.viewDate.getFullYear()
  const month = state.viewDate.getMonth()
  monthDisplay.textContent = `${monthNames[month]} ${year}`

  const firstOfMonth = new Date(year, month, 1)
  const startDay = firstOfMonth.getDay()
  const daysInMonth = new Date(year, month+1, 0).getDate()
  const prevMonthDays = new Date(year, month, 0).getDate()
  const totalCells = Math.ceil((startDay + daysInMonth)/7) * 7

  for(let i=0; i<totalCells; i++){
    const cell = document.createElement('button')
    cell.className = 'day'
    cell.setAttribute('role','button')
    cell.setAttribute('tabindex','0')

    let dayNum, cellDate, outside=false
    const index = i - startDay + 1
    if(index <= 0){
      dayNum = prevMonthDays + index
      cellDate = new Date(year, month-1, dayNum)
      outside = true
    } else if(index > daysInMonth){
      dayNum = index - daysInMonth
      cellDate = new Date(year, month+1, dayNum)
      outside = true
    } else {
      dayNum = index
      cellDate = new Date(year, month, dayNum)
    }

    if(outside) cell.classList.add('outside')

    const dateSpan = document.createElement('div')
    dateSpan.className = 'date'
    dateSpan.textContent = dayNum
    cell.appendChild(dateSpan)

    const key = getKey(cellDate)
    let evs = state.events[key] || []
    if(evs.length){
      // SORT EVENTS BY TIME
      evs = evs.slice().sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time))

      const eventsWrap = document.createElement('div')
      eventsWrap.className = 'events'
      for (let i = 0; i < evs.length; i++) {
  const e = evs[i]
  const evEl = document.createElement('div')
  evEl.textContent = e.time ? `${e.time} — ${e.name}` : e.name
  evEl.style.cursor = 'pointer'
  evEl.addEventListener('click', (event) => {
    event.stopPropagation() // prevent opening "add" modal
    openModal(cellDate, e, i)
  })
  eventsWrap.appendChild(evEl)
}

      cell.appendChild(eventsWrap)
    }

    const todayKey = getKey(new Date())
    if(key === todayKey) cell.classList.add('today')

    cell.addEventListener('click', ()=>openModal(cellDate))

    daysEl.appendChild(cell)
  }
}

    function openModal(date, existingEvent = null, index = null) {
  state.selectedDate = date
  editingIndex = index
  modalOverlay.classList.add('active')

  const dateKey = getKey(date)
  modalDate.textContent = existingEvent
    ? `Edit event for ${dateKey}`
    : `Add event for ${dateKey}`

  if (existingEvent) {
    eventInput.value = existingEvent.name
    const [time, ampm] = existingEvent.time.split(' ')
    const [hour, minute] = time.split(':')
    hourSelect.value = parseInt(hour)
    minuteSelect.value = minute
    ampmSelect.value = ampm
    deleteBtn.style.display = 'inline-block'
  } else {
    eventInput.value = ''
    hourSelect.value = '12'
    minuteSelect.value = '00'
    ampmSelect.value = 'AM'
    deleteBtn.style.display = 'none'
  }

  eventInput.focus()
}

    function closeModal() {
  modalOverlay.classList.remove('active')
  state.selectedDate = null
  editingIndex = null
}

    function changeMonth(delta){
      const d = new Date(state.viewDate)
      d.setMonth(d.getMonth()+delta)
      state.viewDate = d
      render()
    }

    // Keyboard navigation
    document.getElementById('days').addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') changeMonth(-1)
      if(e.key === 'ArrowRight') changeMonth(1)
      if(e.key === 'Home') { state.viewDate = new Date(); render() }
    })

    render()
  </script>
</body>
</html>
